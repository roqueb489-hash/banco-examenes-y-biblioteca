<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biblioteca Digital Sanluisina | IEP San Luis Gonzaga</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --p: #003087;
      --a: #FFD700;
      --l: #f8f9fa;
      --d: #1e293b;
      --r: 20px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--l);
      color: var(--d);
      min-height: 100vh;
      padding-top: 85px;
      padding-bottom: 100px;
    }
    header {
      position: fixed; top: 0; left: 0; right: 0;
      background: linear-gradient(180deg, var(--p), #0146c6);
      color: white; padding: 1rem; text-align: center;
      z-index: 999; box-shadow: 0 6px 30px rgba(0,48,135,0.3);
      display: flex; align-items: center; justify-content: center;
    }
    .header-content { display: flex; align-items: center; gap: 12px; }
    .header-content img { width: 52px; height: 52px; border-radius: 12px; }
    header h1 { font-family: 'Playfair Display', serif; font-size: clamp(1.8rem,5vw,3rem); }
    .container { max-width: 1400px; margin: 0 auto; padding: 1rem; }
    .section-title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(2.4rem,6vw,3.4rem); text-align: center;
      margin: 3rem 0 2rem; padding-top: 100px; margin-top: -100px;
      color: var(--p); font-weight: 900; scroll-margin-top: 140px;
    }
    .cards {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem; margin-bottom: 3rem; justify-items: center;
    }
    .card {
      background: white; border-radius: var(--r); overflow: hidden;
      box-shadow: 0 15px 45px rgba(0,0,0,0.12); transition: .4s;
      border: 3px solid transparent;
    }
    .card:hover { transform: translateY(-16px); border-color: var(--a); }
    .card img { width: 100%; height: 220px; object-fit: cover; background: #f0f0f0; }
    .card h3 { padding: 1rem; font-family: 'Playfair Display', serif; font-size: 1.45rem; text-align: center; font-weight: 800; }
    .btns { padding: 1.3rem; display: flex; gap: 14px; justify-content: center; }
    .btn { padding: 0.95rem 2.1rem; border-radius: 18px; font-weight: 700; text-decoration: none; }
    .ver { background: var(--p); color: white; }
    .desc { background: #dc2626; color: white; }
    .subir {
      text-align: center; margin: 3rem auto;
    }
    .subir button {
      background: var(--p); color: white; padding: 1.2rem 3rem;
      border: none; border-radius: 50px; font-size: 1.4rem; font-weight: 900;
      cursor: pointer; box-shadow: 0 15px 40px rgba(0,48,135,0.3); transition: .3s;
    }
    .subir button:hover { background: #00205e; transform: scale(1.06); }
    .subir a {
      display: block; margin-top: 1rem; color: var(--p); font-weight: 700;
    }
    .loading { text-align: center; padding: 6rem; font-size: 1.6rem; color: var(--p); }
    .spinner { width: 50px; height: 50px; border: 5px solid rgba(0,48,135,0.3); border-top: 5px solid var(--p); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    /* Modal */
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); backdrop-filter: blur(12px); z-index: 9999; align-items: center; justify-content: center; padding: 20px; }
    .modal.active { display: flex; }
    .modal-box { background: white; border-radius: 24px; padding: 2.5rem; max-width: 520px; width: 100%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
    .modal-box h2 { color: var(--p); font-family: 'Playfair Display', serif; font-size: 2.2rem; margin-bottom: 1rem; }
    .modal-box input { width: 100%; padding: 16px; border: 2px solid #ddd; border-radius: 12px; font-size: 1.1rem; margin: 1rem 0; }
    .modal-box button { background: #28a745; color: white; padding: 16px 32px; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: 700; cursor: pointer; margin-top: 1rem; }
    .modal-box button:hover { background: #218838; }
    #mensaje-subida { margin-top: 1.5rem; font-weight: bold; min-height: 30px; }
  </style>
</head>
<body>
<header>
  <div class="header-content">
    <img src="Insignia-New-cuadrado.png" alt="IEP San Luis Gonzaga"
         onerror="this.src='https://via.placeholder.com/52/003087/white?text=SL'">
    <h1>Biblioteca Digital Sanluisina</h1>
  </div>
</header>
<div class="container">
  <div class="loading" id="loading">
    <div class="spinner"></div>
    Cargando libros...
  </div>

  <h2 class="section-title" id="seccion1">Creencias y Tradiciones Huanuqueñas</h2>
  <div class="cards" id="cont-seccion1"></div>
  <div class="subir">
    <button onclick="abrirModalSubir('1z8prGUC0uJ1B_XNHsTzHrqW7hZ7KIAjO')">SUBIR NUEVO LIBRO</button>
    <a href="https://drive.google.com/drive/folders/1z8prGUC0uJ1B_XNHsTzHrqW7hZ7KIAjO" target="_blank">O abrir carpeta en Drive</a>
  </div>

  <h2 class="section-title" id="seccion2">Leyendas, Fábulas y Mitos</h2>
  <div class="cards" id="cont-seccion2"></div>
  <div class="subir">
    <button onclick="abrirModalSubir('1PYBr9zTjhCBVD8Sv65XAcR_C1_veQtFd')">SUBIR NUEVO LIBRO</button>
    <a href="https://drive.google.com/drive/folders/1PYBr9zTjhCBVD8Sv65XAcR_C1_veQtFd" target="_blank">O abrir carpeta en Drive</a>
  </div>

  <h2 class="section-title" id="seccion3">Libros Bíblicos y Religiosos</h2>
  <div class="cards" id="cont-seccion3"></div>
  <div class="subir">
    <button onclick="abrirModalSubir('1LjGbGaSHk4JZ0ynVwjLLixSanZxcUaXc')">SUBIR NUEVO LIBRO</button>
    <a href="https://drive.google.com/drive/folders/1LjGbGaSHk4JZ0ynVwjLLixSanZxcUaXc" target="_blank">O abrir carpeta en Drive</a>
  </div>

  <h2 class="section-title" id="seccion4">Libros y textos religiosos</h2>
  <div class="cards" id="cont-seccion4"></div>
  <div class="subir">
    <button onclick="abrirModalSubir('1A8BgZZOeDihPMSk9SkwEEMTb_k3-RJFY')">SUBIR NUEVO LIBRO</button>
    <a href="https://drive.google.com/drive/folders/1A8BgZZOeDihPMSk9SkwEEMTb_k3-RJFY" target="_blank">O abrir carpeta en Drive</a>
  </div>

  <h2 class="section-title" id="seccion5">Literatura Huanuqueña</h2>
  <div class="cards" id="cont-seccion5"></div>
  <div class="subir">
    <button onclick="abrirModalSubir('1DevVgGKwPTEtHVbz82RBqfoG-nNMCXZB')">SUBIR NUEVO LIBRO</button>
    <a href="https://drive.google.com/drive/folders/1DevVgGKwPTEtHVbz82RBqfoG-nNMCXZB" target="_blank">O abrir carpeta en Drive</a>
  </div>

  <h2 class="section-title" id="seccion6">Literatura Peruana</h2>
  <div class="cards" id="cont-seccion6"></div>
  <div class="subir">
    <button onclick="abrirModalSubir('1yHiDEAHdic_ByiL6qax-R26Pd0x5s0pe')">SUBIR NUEVO LIBRO</button>
    <a href="https://drive.google.com/drive/folders/1yHiDEAHdic_ByiL6qax-R26Pd0x5s0pe" target="_blank">O abrir carpeta en Drive</a>
  </div>

  <h2 class="section-title" id="seccion7">Mitos y Creencias Peruanas</h2>
  <div class="cards" id="cont-seccion7"></div>
  <div class="subir">
    <button onclick="abrirModalSubir('1LddIPgywrGppPGG_A_LNYfyKTVQxOH0-')">SUBIR NUEVO LIBRO</button>
    <a href="https://drive.google.com/drive/folders/1LddIPgywrGppPGG_A_LNYfyKTVQxOH0-" target="_blank">O abrir carpeta en Drive</a>
  </div>
</div>

<!-- Modal Subir Libro -->
<div class="modal" id="modal-subir">
  <div class="modal-box">
    <h2>Subir Nuevo Libro</h2>
    <p>Ingresa el título y autor. El archivo se renombrará automáticamente.</p>
    <input type="text" id="titulo-libro" placeholder="Título del libro" autofocus>
    <input type="text" id="autor-libro" placeholder="Autor (opcional)">
    <input type="file" id="archivo-pdf" accept=".pdf" required>
    <button id="btn-subir-pdf">Subir PDF</button>
    <div id="mensaje-subida"></div>
  </div>
</div>

<script>
  const DEPLOY_URL = "https://script.google.com/macros/s/AKfycbyKMz5v5A2QB5AsbfcRAR0joA_6wf5-SymU0HblhzLH_dvrz3cHLyQThUUAzb1AnkFfRQ/exec";

  const CARPETAS = [
    "1z8prGUC0uJ1B_XNHsTzHrqW7hZ7KIAjO",
    "1PYBr9zTjhCBVD8Sv65XAcR_C1_veQtFd",
    "1LjGbGaSHk4JZ0ynVwjLLixSanZxcUaXc",
    "1A8BgZZOeDihPMSk9SkwEEMTb_k3-RJFY",
    "1DevVgGKwPTEtHVbz82RBqfoG-nNMCXZB",
    "1yHiDEAHdic_ByiL6qax-R26Pd0x5s0pe",
    "1LddIPgywrGppPGG_A_LNYfyKTVQxOH0-"
  ];

  const contenedores = [1,2,3,4,5,6,7].map(n => document.getElementById('cont-seccion'+n));

  let carpetaIdActual = '';

  function abrirModalSubir(id) {
    carpetaIdActual = id;
    document.getElementById('modal-subir').classList.add('active');
    document.getElementById('titulo-libro').focus();
    document.getElementById('mensaje-subida').innerHTML = '';
    document.getElementById('archivo-pdf').value = '';
  }

  document.getElementById('modal-subir').addEventListener('click', (e) => {
    if (e.target === document.getElementById('modal-subir')) {
      document.getElementById('modal-subir').classList.remove('active');
    }
  });

  document.getElementById('btn-subir-pdf').addEventListener('click', () => {
    const titulo = document.getElementById('titulo-libro').value.trim();
    const autor = document.getElementById('autor-libro').value.trim();
    const file = document.getElementById('archivo-pdf').files[0];

    if (!titulo || !file || !file.name.toLowerCase().endsWith('.pdf')) {
      document.getElementById('mensaje-subida').innerHTML = 'Faltan datos o archivo no es PDF';
      document.getElementById('mensaje-subida').style.color = 'red';
      return;
    }

    const nombreFinal = autor ? `${titulo} - ${autor}.pdf` : `${titulo}.pdf`;

    document.getElementById('mensaje-subida').innerHTML = 'Subiendo...';
    document.getElementById('mensaje-subida').style.color = '#0066cc';

    const reader = new FileReader();
    reader.onload = (e) => {
      const base64 = e.target.result.split(',')[1];
      // Aquí puedes enviar a un script de subida si lo tienes, o simplemente redirigir
      // Por ahora, como no tienes script de subida directa, redirigimos a Drive con sugerencia
      alert(`Recomendación: Sube el PDF a la carpeta y renómbralo a "${nombreFinal}"`);
      window.open(`https://drive.google.com/drive/folders/${carpetaIdActual}`, '_blank');
      document.getElementById('modal-subir').classList.remove('active');
    };
    reader.readAsDataURL(file);
  });

  async function cargarTodo() {
    for (let i = 0; i < 7; i++) {
      try {
        const res = await fetch(`${DEPLOY_URL}?carpeta=${CARPETAS[i]}`);
        let archivos = await res.json();
        archivos = archivos.filter(f => f.mimeType !== 'application/vnd.google-apps.folder');
        archivos.sort((a, b) => new Date(b.modifiedTime || 0) - new Date(a.modifiedTime || 0));
        if (archivos.length === 0) {
          contenedores[i].innerHTML = '<p style="grid-column:1/-1;text-align:center;padding:6rem;color:#666;font-size:1.4rem">Aún no hay libros en esta sección</p>';
          continue;
        }
        archivos.forEach(f => {
          const nombre = f.name.replace(/\.pdf$/i, '');
          contenedores[i].innerHTML += `
            <div class="card">
              <img src="https://drive.google.com/thumbnail?id=${f.id}&sz=w800" alt="${nombre}"
                   onerror="this.src='https://via.placeholder.com/400x220/003087/white?text=LIBRO'">
              <div class="card-content">
                <h3>${nombre}</h3>
                <div class="btns">
                  <a href="https://drive.google.com/file/d/${f.id}/preview" target="_blank" class="btn ver">Leer</a>
                  <a href="https://drive.google.com/uc?id=${f.id}&export=download" class="btn desc">Descargar</a>
                </div>
              </div>
            </div>`;
        });
      } catch (e) {
        contenedores[i].innerHTML = '<p style="color:#dc2626;text-align:center;padding:4rem">Error al cargar</p>';
      }
    }
    document.getElementById('loading').style.display = 'none';
  }

  cargarTodo();
</script>
</body>
</html>
